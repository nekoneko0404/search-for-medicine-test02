# あなたのサイトは大丈夫？ウェブサイトのセキュリティ脆弱性を2つ修正した話

こんにちは！

先日、個人で開発している医薬品検索サイト「Kusuri Compass」のセキュリティを見直す機会があり、いくつかの修正を行いました。

今回は、その中でも特に重要だと感じた**「リンクの開き方」**と**「外部ライブラリの管理」**に関する脆弱性と、その具体的な対策について、備忘録も兼ねてご紹介します。

## 1. `target="_blank"` に潜む危険性

他のページへのリンクを貼る際、`target="_blank"` を使って新しいタブで開くように設定することはよくありますよね。私もサイト内の多くの箇所で多用していました。

```html
<a href="https://example.com" target="_blank">外部サイトへ</a>
```

しかし、この書き方だけだと、実はセキュリティ上のリスクがあることをご存知でしたか？

### どんなリスク？

`target="_blank"` を指定したリンクには、リンク先のページから `window.opener` というオブジェクトを通して、元のページ（つまり自分のサイト）を操作できてしまうという脆弱性があります。

これを悪用されると、例えばリンク先のページで「セッションが切れました。再ログインしてください」といった偽のログイン画面に元のページを書き換え、IDやパスワードを盗み取る**フィッシング詐欺**に繋がる可能性があります。

### どう修正した？

対策はとても簡単で、`<a>` タグに `rel="noopener noreferrer"` を追加するだけです。

*   **`noopener`**: `window.opener` を `null` にして、リンク先からの操作を完全に防ぎます。
*   **`noreferrer`**: リファラ情報（どのページから遷移してきたか）をリンク先に送らないようにします。プライバシー保護の観点からも有効です。

#### 修正例 (`index.html`)

私のサイトでは、以下のようにHTMLとJavaScriptの両方を修正しました。

**修正前 (HTML):**
```html
<a href="./update.html" target="_blank" class="...">情報更新日検索</a>
```

**修正後 (HTML):**
```html
<a href="./update.html" target="_blank" rel="noopener noreferrer" class="...">情報更新日検索</a>
```

**修正前 (JavaScript):**
```javascript
window.open(url, '_blank');
```

**修正後 (JavaScript):**
```javascript
window.open(url, '_blank', 'noopener,noreferrer');
```

## 2. 古いJavaScriptライブラリの危険性

ウェブサイトに動きや便利な機能を追加するために、**jQuery**のようなJavaScriptライブラリを利用している方は多いと思います。

これらのライブラリは開発を効率化してくれますが、古いバージョンを使い続けることには注意が必要です。

### どんなリスク？

ライブラリもソフトウェアであるため、時としてセキュリティ上の欠陥（**脆弱性**）が見つかります。古いバージョンは、その脆弱性が修正されないまま放置されている状態です。

代表的な攻撃に**クロスサイトスクリプティング（XSS）**があり、攻撃者はライブラリの脆弱性を悪用してサイトに悪意のあるスクリプトを埋め込み、ユーザー情報を盗んだり、サイトを改ざんしたりする可能性があります。

### どう修正した？

対策は、ライブラリを読み込んでいるCDN（コンテンツデリバリネットワーク）のURLを、脆弱性が修正された**新しいバージョン**のものに更新することです。

#### 修正例

私の別のプロジェクトでは、jQueryのバージョンが古いままでしたので、以下のように修正しました。

**修正前:**
```html
<script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
```

**修正後:**
```html
<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
```
*(※バージョンは記事執筆時点のものです。常に最新の安定版を確認することが重要です)*

定期的に利用しているライブラリの公式サイトなどをチェックして、セキュリティ情報や最新バージョンを確認する習慣が大切です。

## まとめ

今回は、`target="_blank"` の設定と、古いJavaScriptライブラリの更新という、比較的簡単な修正で対応できる2つの脆弱性をご紹介しました。

どちらも放置しておくと大きな問題に繋がりかねないものです。ウェブサイトを公開している方は、これを機にご自身のサイトのセキュリティを一度見直してみてはいかがでしょうか。