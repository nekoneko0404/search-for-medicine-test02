<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã€Kusuri Compassã€‘åŒ»è–¬å“å‡ºè·çŠ¶æ³æ¤œç´¢</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/xlsx/dist/xlsx.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/localforage@1.10.0/dist/localforage.min.js"></script>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght400;700&display=swap">
    <link rel="stylesheet" href="unify.css">
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-CT2JQPSMPL"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-CT2JQPSMPL');
    </script>
</head>
<body class="bg-gray-200 p-4 sm:p-8 flex flex-col items-center min-h-screen">
    <div class="page-wrapper">
        <div class="page-header">
            <h2 class="page-title flex items-center space-x-2">
                <img src="images/KusuriCompass.png" alt="Kusuri Compass Icon" class="h-8 w-8 sm:h-10 sm:w-10">
                <span class="hidden sm:inline">ã€Kusuri Compassã€‘å‡ºè·çŠ¶æ³æ¤œç´¢</span>
                <span class="sm:hidden">åŒ»è–¬å“ å‡ºè·çŠ¶æ³</span>
            </h2>
            <div class="flex items-center space-x-2">
                <a href="./update.html" target="_blank" class="bg-blue-500 text-white hover:bg-blue-600 transition duration-150 ease-in-out py-1 px-3 rounded-md shadow-sm font-medium whitespace-nowrap text-sm sm:text-base">
                    <span class="sm:hidden">æ›´æ–°æ—¥</span>
                    <span class="hidden sm:inline">æƒ…å ±æ›´æ–°æ—¥æ¤œç´¢</span>
                </a>
                <a href="./readme.html" target="_blank" class="bg-indigo-500 text-white hover:bg-indigo-600 transition duration-150 ease-in-out py-1 px-3 rounded-md shadow-sm font-medium whitespace-nowrap text-sm sm:text-base">
                    ä½¿ã„æ–¹
                </a>
            </div>
        </div>
        
        <div id="messageBox" class="text-sm sm:text-base text-center p-3 rounded-lg hidden message-box-center w-3/4"></div>
        
        <div class="search-form-grid mb-6">
            <div class="input-container">
                <label for="drugName" class="block text-gray-700 text-sm font-medium mb-1">åŒ»è–¬å“å:</label>
                <input type="text" id="drugName" placeholder="ä¾‹: ãƒ­ã‚­ã‚½ãƒ‹ãƒ³" class="w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring focus:ring-indigo-200 focus:ring-opacity-50 transition ease-in-out duration-150 p-2">
            </div>
            <div class="input-container">
                <label for="ingredientName" class="block text-gray-700 text-sm font-medium mb-1">æˆåˆ†å:</label>
                <input type="text" id="ingredientName" placeholder="ä¾‹: ãƒ­ã‚­ã‚½ãƒ—ãƒ­ãƒ•ã‚§ãƒ³" class="w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring focus:ring-indigo-200 focus:ring-opacity-50 transition ease-in-out duration-150 p-2">
            </div>
            <div class="input-container">
                <label for="makerName" class="block text-gray-700 text-sm font-medium mb-1">è¦æ ¼ã€å‰¤å½¢ã€ï¾’ï½°ï½¶ï½°:</label>
                <input type="text" id="makerName" placeholder="ä¾‹: 60mg" class="w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring focus:ring-indigo-200 focus:ring-opacity-50 transition ease-in-out duration-150 p-2">
            </div>
            
            <div class="status-checkbox-container flex flex-col justify-between">
                <div class="block text-gray-700 text-sm font-medium mb-1">å‡ºè·çŠ¶æ³:</div>
                <div class="status-checkbox-group pb-2">
                    <div class="checkbox-item flex items-center">
                        <input type="checkbox" id="statusNormal" value="é€šå¸¸å‡ºè·" checked class="form-checkbox h-4 w-4 text-indigo-600 transition duration-150 ease-in-out">
                        <label for="statusNormal" class="ml-1 text-xs text-gray-900">é€šå¸¸å‡ºè·</label>
                    </div>
                    <div class="checkbox-item flex items-center">
                        <input type="checkbox" id="statusLimited" value="é™å®šå‡ºè·" checked class="form-checkbox h-4 w-4 text-indigo-600 transition duration-150 ease-in-out">
                        <label for="statusLimited" class="ml-1 text-xs text-gray-900">é™å®šå‡ºè·</label>
                    </div>
                    <div class="checkbox-item flex items-center">
                        <input type="checkbox" id="statusStopped" value="ä¾›çµ¦åœæ­¢" checked class="form-checkbox h-4 w-4 text-indigo-600 transition duration-150 ease-in-out">
                        <label for="statusStopped" class="ml-1 text-xs text-gray-900">ä¾›çµ¦åœæ­¢</label>
                    </div>
                </div>
            </div>
            
        </div>
        
        <div id="tableContainer" class="table-container rounded-lg shadow-md border border-gray-200 hidden">
            <table id="resultTable" class="min-w-full divide-y divide-gray-200 table-fixed">
                <thead class="bg-indigo-100 sticky top-0">
                    <tr>
                        <th class="px-2 py-2 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider whitespace-nowrap lg:w-[28%]">å“å</th>
                        <th class="px-2 py-2 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider whitespace-nowrap lg:w-[28%]">æˆåˆ†å</th>
                        <th class="px-1 py-2 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider whitespace-nowrap lg:w-[15%]">
                            <div class="flex items-center justify-start"> <span class="whitespace-nowrap">å‡ºè·çŠ¶æ³</span>
                                <button onclick="sortResults('status')" class="ml-1 text-indigo-600 hover:text-indigo-800 transition-colors duration-150">
                                    <span id="sort-status-icon">â–²</span>
                                </button>
                            </div>
                        </th>
                        <th class="px-2 py-2 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider whitespace-nowrap lg:w-[18%]">åˆ¶é™ç†ç”±</th>
                        <th class="px-2 py-2 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider whitespace-nowrap lg:w-[11%]">å‡ºè·é‡çŠ¶æ³</th>
                    </tr>
                </thead>
                <tbody class="bg-white divide-y divide-gray-200" id="resultTableBody">
                    </tbody>
            </table>
        </div>
        
        <div class="mt-8 text-center text-gray-500 text-sm">
            <p>ã”æ„è¦‹ãƒ»ã”è¦æœ›ã¯è£½ä½œè€…ã¾ã§ãŠå¯„ã›ãã ã•ã„ã€‚</p>
            <p>ãƒ„ã‚¤ãƒƒã‚¿ãƒ¼: <a href="https://x.com/oshigoto_twitte" target="_blank" class="text-indigo-500 hover:underline">@oshigoto_twitte</a></p>
        </div>
    </div>

    <script>
        let excelData = [];
        let filteredResults = [];
        let sortStates = {
            status: 'asc'
        };
        const messageBox = document.getElementById('messageBox');
        const tableContainer = document.getElementById('tableContainer');
        let isComposing = false;
<<<<<<< HEAD

=======
        
>>>>>>> 15b4aceefd526650001e83b755f4ac3ffedf467d
        function showMessage(text, type = 'info') {
            messageBox.textContent = text;
            messageBox.classList.remove('hidden', 'bg-red-200', 'text-red-800', 'bg-green-200', 'text-green-800', 'bg-blue-200', 'text-blue-800');
            messageBox.classList.add('block');
            if (type === 'error') {
                messageBox.classList.add('bg-red-200', 'text-red-800');
            } else if (type === 'success') {
                messageBox.classList.add('bg-green-200', 'text-green-800');
            } else {
                messageBox.classList.add('bg-blue-200', 'text-blue-800');
            }
        }
        function hideMessage(delay) {
            setTimeout(() => {
                messageBox.classList.add('hidden');
            }, delay);
        }
        function normalizeString(str) {
            if (!str) return '';
<<<<<<< HEAD
            const hiraToKata = str.replace(/[ã-ã‚–]/g, function(match) {
=======
            const hiraToKata = str.replace(/[\u3041-\u3096]/g, function(match) {
>>>>>>> 15b4aceefd526650001e83b755f4ac3ffedf467d
                const charCode = match.charCodeAt(0) + 0x60;
                return String.fromCharCode(charCode);
            });
            const normalizedStr = hiraToKata.normalize('NFKC');
            return normalizedStr.toLowerCase();
        }
        function getSearchKeywords(input) {
            return input.split(/\s+|ã€€+/).filter(keyword => keyword !== '').map(keyword => normalizeString(keyword));
        }
<<<<<<< HEAD

=======
>>>>>>> 15b4aceefd526650001e83b755f4ac3ffedf467d
        function processExcelData(data) {
            try {
                const workbook = XLSX.read(data, {type: 'array'});
                const sheetName = workbook.SheetNames[0];
<<<<<<< HEAD
                const worksheet = workbook.Sheets[sheetName];
                
                const jsonDataWithStrings = XLSX.utils.sheet_to_json(worksheet, { header: 1, range: 1, defval: "" });
                const jsonDataWithNumbers = XLSX.utils.sheet_to_json(worksheet, { header: 1, range: 1, raw: true, defval: "" });

                if (jsonDataWithStrings.length < 2) { 
                    excelData = [];
                    showMessage("Excelãƒ•ã‚¡ã‚¤ãƒ«ã«å‡¦ç†ã§ãã‚‹ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“ã€‚", "info");
                    hideMessage(2000);
                    return;
                }

                const dataRowsAsStrings = jsonDataWithStrings.slice(1);
                const dataRowsAsNumbers = jsonDataWithNumbers.slice(1);

                const mappedData = dataRowsAsStrings.map((row, index) => {
                    const numberRow = dataRowsAsNumbers[index];
                    return {
                        'productName':          row[5],
                        'ingredientName':       row[2],
                        'manufacturer':         row[6],
                        'shipmentStatus':       row[11],
                        'reasonForLimitation':  row[13],
                        'resolutionProspect':   row[14],
                        'expectedDate':         numberRow[15] || row[15],
                        'shipmentVolumeStatus': row[16],
                        'yjCode':               row[4],
                        'standard':             row[3],
                        'isGeneric':            row[7],
                        'isBasicDrug':          row[8],
                        'updateDateSerial':     numberRow[12] || row[12]
                    };
                });

                excelData = mappedData;

=======
                const sheet = workbook.Sheets[sheetName];
                excelData = XLSX.utils.sheet_to_json(sheet, {header:1});
                showMessage("ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ãŒå®Œäº†ã—ã¾ã—ãŸã€‚", "success");
                hideMessage(2000);
>>>>>>> 15b4aceefd526650001e83b755f4ac3ffedf467d
            } catch (error) {
                console.error('Error processing data:', error);
                showMessage("ãƒ‡ãƒ¼ã‚¿ã®å‡¦ç†ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚", "error");
                hideMessage(2000);
            }
        }

<<<<<<< HEAD
        function renderStatusButton(status) {
            const trimmedStatus = (status || "").trim();
=======
        /**
         * @param {string} status å‡ºè·çŠ¶æ³ã®æ–‡å­—åˆ— (ä¾‹: 'é™å®šå‡ºè·')
         * @returns {string} Tailwind CSSã§è£…é£¾ã•ã‚ŒãŸ<span>ã‚¿ã‚°ã®HTMLæ–‡å­—åˆ—
         */
        function renderStatusButton(status) {
            const trimmedStatus = (status || "").trim();
            // ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ãƒ–ãƒ­ãƒƒã‚¯è¦ç´ ã«ã™ã‚‹ã“ã¨ã§ã€ãƒªãƒ³ã‚¯ãŒãƒœã‚¿ãƒ³å…¨ä½“ã‚’è¦†ã†ã‚ˆã†ã«ã™ã‚‹
>>>>>>> 15b4aceefd526650001e83b755f4ac3ffedf467d
            let baseClass = "px-3 py-1 rounded-full text-xs font-semibold whitespace-nowrap inline-block transition-colors duration-150";
            
            if (trimmedStatus.includes("é€šå¸¸å‡ºè·") || trimmedStatus.includes("é€š")) {
                return `<span class="${baseClass} bg-indigo-500 text-white hover:bg-indigo-600">é€šå¸¸å‡ºè·</span>`; 
<<<<<<< HEAD
            } else if (trimmedStatus.includes("é™å®šå‡ºè·") || trimmedStatus.includes("å‡ºè·åˆ¶é™") || trimmedStatus.includes("é™") || trimmedStatus.includes("åˆ¶")) {
                return `<span class="${baseClass} bg-yellow-400 text-gray-800 hover:bg-yellow-500">é™å®šå‡ºè·</span>`;
            } else if (trimmedStatus.includes("ä¾›çµ¦åœæ­¢") || trimmedStatus.includes("åœæ­¢") || trimmedStatus.includes("åœ")) {
                return `<span class="${baseClass} bg-gray-700 text-white hover:bg-gray-800">ä¾›çµ¦åœæ­¢</span>`;
            } else {
=======
            } else if (trimmedStatus.includes("é™å®šå‡ºè·") || trimmedStatus.includes("é™å®šå‡ºè·") || trimmedStatus.includes("é™") || trimmedStatus.includes("åˆ¶")) {
                return `<span class="${baseClass} bg-yellow-400 text-gray-800 hover:bg-yellow-500">é™å®šå‡ºè·</span>`; // âœ… å¤‰æ›´
            } else if (trimmedStatus.includes("ä¾›çµ¦åœæ­¢") || trimmedStatus.includes("åœæ­¢") || trimmedStatus.includes("åœ")) {
                return `<span class="${baseClass} bg-gray-700 text-white hover:bg-gray-800">ä¾›çµ¦åœæ­¢</span>`; // âœ… å¤‰æ›´
            } else {
                // ãã®ä»–ã®å ´åˆã¯å…ƒã®æ–‡å­—åˆ—ã€ã¾ãŸã¯ä¸æ˜ãªã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã¨ã—ã¦è¡¨ç¤º
>>>>>>> 15b4aceefd526650001e83b755f4ac3ffedf467d
                return `<span class="${baseClass} bg-gray-200 text-gray-800 hover:bg-gray-300">${trimmedStatus || "ä¸æ˜"}</span>`; 
            }
        }

<<<<<<< HEAD
=======

>>>>>>> 15b4aceefd526650001e83b755f4ac3ffedf467d
        function searchData() {
            if (excelData.length === 0) {
                return;
            }

            const drugKeywords = getSearchKeywords(document.getElementById('drugName').value);
            const ingredientKeywords = getSearchKeywords(document.getElementById('ingredientName').value);
            const makerKeywords = getSearchKeywords(document.getElementById('makerName').value);
            
            const allCheckboxesChecked = document.getElementById('statusNormal').checked && document.getElementById('statusLimited').checked && document.getElementById('statusStopped').checked;
            const allSearchFieldsEmpty = drugKeywords.length === 0 && ingredientKeywords.length === 0 && makerKeywords.length === 0;

            if (allSearchFieldsEmpty && allCheckboxesChecked) {
                renderTable([]);
                tableContainer.classList.add('hidden');
                hideMessage(0);
                return;
            } else {
                tableContainer.classList.remove('hidden');
            }
            
            const statusFilters = [];
<<<<<<< HEAD
            if (document.getElementById('statusNormal').checked) statusFilters.push("é€šå¸¸å‡ºè·");
            if (document.getElementById('statusLimited').checked) statusFilters.push("é™å®šå‡ºè·");
            if (document.getElementById('statusStopped').checked) statusFilters.push("ä¾›çµ¦åœæ­¢");

            filteredResults = excelData.filter(item => {
                if (!item) return false;

                const drugName = normalizeString(item.productName || "");
                const ingredientName = normalizeString(item.ingredientName || "");
                const makerName = normalizeString((item.standard || "") + (item.manufacturer || ""));
=======
            if (document.getElementById('statusNormal').checked) {
                statusFilters.push("é€šå¸¸å‡ºè·");
            }
            if (document.getElementById('statusLimited').checked) {
                statusFilters.push("é™å®šå‡ºè·"); 
                statusFilters.push("é™å®šå‡ºè·"); 
            }
            if (document.getElementById('statusStopped').checked) {
                statusFilters.push("ä¾›çµ¦åœæ­¢");
            }

            filteredResults = [];
            for (let i = 1; i < excelData.length; i++) {
                const row = excelData[i];
                if (!row || row.length < 17) continue;

                const drugName = normalizeString(row[5] || "");
                const ingredientName = normalizeString(row[2] || "");
                const makerName = normalizeString((row[6] || "") + (row[9] || ""));
                const currentStatus = (row[11] || '').trim(); 
>>>>>>> 15b4aceefd526650001e83b755f4ac3ffedf467d

                const matchDrug = drugKeywords.every(keyword => drugName.includes(keyword));
                const matchIngredient = ingredientKeywords.every(keyword => ingredientName.includes(keyword));
                const matchMaker = makerKeywords.every(keyword => drugName.includes(keyword) || makerName.includes(keyword));
                
<<<<<<< HEAD
                if (statusFilters.length === 0) return false;

                const currentStatus = (item.shipmentStatus || '').trim();
                let matchStatus = false;

                if (statusFilters.includes("é€šå¸¸å‡ºè·") && (currentStatus.includes("é€šå¸¸å‡ºè·") || currentStatus.includes("é€š"))) {
                    matchStatus = true;
                }
                if (statusFilters.includes("é™å®šå‡ºè·") && (currentStatus.includes("é™å®šå‡ºè·") || currentStatus.includes("å‡ºè·åˆ¶é™") || currentStatus.includes("é™") || currentStatus.includes("åˆ¶"))) {
                    matchStatus = true;
                }
                if (statusFilters.includes("ä¾›çµ¦åœæ­¢") && (currentStatus.includes("ä¾›çµ¦åœæ­¢") || currentStatus.includes("åœæ­¢") || currentStatus.includes("åœ"))) {
                    matchStatus = true;
                }
                
                return matchDrug && matchIngredient && matchMaker && matchStatus;
            });
=======
                let matchStatus = false;
                let statusText = '';
                if (currentStatus.includes('é€šå¸¸') || currentStatus.includes('é€š')) {
                    statusText = 'é€šå¸¸å‡ºè·';
                } else if (currentStatus.includes('é™å®š') || currentStatus.includes('é™') || currentStatus.includes('åˆ¶é™') || currentStatus.includes('åˆ¶')) { 
                    statusText = 'é™å®šå‡ºè·';
                    if (currentStatus.includes('é™å®š')) statusText = 'é™å®šå‡ºè·'; 
                } else if (currentStatus.includes('åœæ­¢') || currentStatus.includes('åœ')) {
                    statusText = 'ä¾›çµ¦åœæ­¢';
                }
                
                if (statusFilters.includes(statusText)) {
                    matchStatus = true;
                }
                
                if (matchDrug && matchIngredient && matchMaker && matchStatus) {
                    filteredResults.push(row);
                }
            }
>>>>>>> 15b4aceefd526650001e83b755f4ac3ffedf467d
            
            renderTable(filteredResults);
            
            if (filteredResults.length === 0) {
                 showMessage("æ¤œç´¢çµæœãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚", "info");
                 hideMessage(2000);
            } else if (filteredResults.length > 500) {
                 showMessage(`${filteredResults.length} ä»¶ã®ãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã—ãŸã€‚\nè¡¨ç¤ºã¯ä¸Šä½ 500 ä»¶ã«åˆ¶é™ã•ã‚Œã¦ã„ã¾ã™ã€‚`, "success");
                 hideMessage(2000);
            } else {
                 showMessage(`${filteredResults.length} ä»¶ã®ãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã—ãŸã€‚`, "success");
                 hideMessage(2000);
            }

            sortStates.status = 'asc';
            document.getElementById('sort-status-icon').textContent = 'â–²';
        }
        
<<<<<<< HEAD
=======
        // handleIngredientClické–¢æ•°ã¯å¤‰æ›´ãªã—
>>>>>>> 15b4aceefd526650001e83b755f4ac3ffedf467d
        function handleIngredientClick(ingredient) {
            document.getElementById('drugName').value = '';
            document.getElementById('makerName').value = '';
            const searchIngredient = ingredient.length > 5 ? ingredient.substring(0, 5) : ingredient;
            document.getElementById('ingredientName').value = searchIngredient;
            searchData();
            showMessage(`ã€Œ${searchIngredient}ã€ã§å†æ¤œç´¢ã‚’å®Ÿè¡Œã—ã¾ã—ãŸã€‚`, 'info');
            hideMessage(2000);
        }

        function extractSearchTerm(text) {
            if (!text) return '';
<<<<<<< HEAD
            let match = text.match(/^([ä¸€-é¾¯ã‚¡-ãƒ¶ãƒ¼]+(?:[ä¸€-é¾¯ã‚¡-ãƒ¶ãƒ¼]+)*)/);
            if (match && match) { return match; }
            match = text.match(/[^ä¸€-é¾¯ã‚¡-ãƒ¶ãƒ¼A-Za-z0-9]*([ä¸€-é¾¯ã‚¡-ãƒ¶ãƒ¼]+(?:[ä¸€-é¾¯ã‚¡-ãƒ¶ãƒ¼]+)*)/);
            if (match && match) { return match; }
            return text;
        }

=======

            // æ¼¢å­—ã¨ã‚«ã‚¿ã‚«ãƒŠã€ã¾ãŸã¯ã‚«ã‚¿ã‚«ãƒŠã¨æ¼¢å­—ãŒé€£ç¶šã—ã¦ã„ã‚‹å ´åˆã¯ä¸¡æ–¹ã‚’å«ã‚ã‚‹
            // ä¾‹: å°å…ç”¨ãƒ¬ãƒ«ãƒ™ã‚¢ï¼•ï¼ã‚¨ãƒªãƒ—ã‚¿ï¼“ï¼å¸å…¥ç”¨ -> å°å…ç”¨ãƒ¬ãƒ«ãƒ™ã‚¢
            // ä¾‹: ãƒ¬ãƒ«ãƒ™ã‚¢å°å…ç”¨ï¼•ï¼ã‚¨ãƒªãƒ—ã‚¿ï¼“ï¼å¸å…¥ç”¨ -> ãƒ¬ãƒ«ãƒ™ã‚¢å°å…ç”¨
            let match = text.match(/^([ä¸€-é¾¯ã‚¡-ãƒ¶ãƒ¼]+(?:[ä¸€-é¾¯ã‚¡-ãƒ¶ãƒ¼]+)*)/);
            if (match && match) {
                return match;
            }

            // è¨˜å·ã‚„æ•°å­—ã§å§‹ã¾ã£ã¦ã„ã‚‹ã‚‚ã®ã¯ãã®ã‚ã¨ã‹ã‚‰ã€ä»¥é™ã¯åŒæ§˜
            // ä¾‹: ï¼•ï¼ã‚¨ãƒªãƒ—ã‚¿ï¼“ï¼å¸å…¥ç”¨ -> ã‚¨ãƒªãƒ—ã‚¿
            match = text.match(/[^ä¸€-é¾¯ã‚¡-ãƒ¶ãƒ¼A-Za-z0-9]*([ä¸€-é¾¯ã‚¡-ãƒ¶ãƒ¼]+(?:[ä¸€-é¾¯ã‚¡-ãƒ¶ãƒ¼]+)*)/);
            if (match && match) {
                return match;
            }
            
            // ä¸Šè¨˜ã®ã„ãšã‚Œã«ã‚‚å½“ã¦ã¯ã¾ã‚‰ãªã„å ´åˆã€å…ƒã®ãƒ†ã‚­ã‚¹ãƒˆã‚’è¿”ã™
            return text;
        }

        // ä¿®æ­£ç®‡æ‰€ï¼š/hiyari_app/index.html ã«æ¸¡ã™ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’æ­£è¦åŒ–ã—ã¦å˜ä¸€ã®æˆåˆ†åã ã‘æ¸¡ã™
>>>>>>> 15b4aceefd526650001e83b755f4ac3ffedf467d
        function openHiyariPage(type, name) {
            const hiyariBaseUrl = './hiyari_app/index.html';
            let extractedName = extractSearchTerm(name);

<<<<<<< HEAD
            if (Array.isArray(extractedName)) {
                extractedName = extractedName || '';
=======
            // extractSearchTerm ã¯ match ã®é…åˆ—ãŒè¿”ã‚‹ã“ã¨ãŒã‚ã‚‹ãŸã‚ã€æ–‡å­—åˆ—åŒ–ã—ã¦æ­£ã—ãæ‰±ã†
            if (Array.isArray(extractedName)) {
                extractedName = extractedName[0] || '';
>>>>>>> 15b4aceefd526650001e83b755f4ac3ffedf467d
            } else if (typeof extractedName !== 'string') {
                extractedName = String(extractedName || '');
            }

            let finalName = extractedName;

<<<<<<< HEAD
            if (type === 'ingredientName' && finalName) {
                const parts = finalName.split(/[ï¼Œ,ã€]/).map(p => p.trim()).filter(p => p !== '');
                let candidate = '';
                for (const p of parts) {
                    const m = p.match(/([ã‚¡-ãƒ¶ãƒ¼]+)/);
                    if (m && m) {
                        candidate = m;
                        break;
                    }
                }
                if (!candidate && parts.length > 0) {
                    candidate = parts.replace(/^[ï¼¬L][ï¼-]?/, '').trim();
                }
                if (candidate) {
                    finalName = candidate;
                } else if (parts.length > 0) {
                    finalName = parts;
=======
            // æˆåˆ†åã®å ´åˆã¯ã‚«ãƒ³ãƒåŒºåˆ‡ã‚Šã‚„æ¥é ­è¾ï¼ˆä¾‹: ï¼¬ï¼ï¼‰ã‚’å–ã‚Šé™¤ã„ã¦
            // å®Ÿç”¨çš„ãªã€Œå˜ä¸€ã®æˆåˆ†åï¼ˆä¸»ã«ã‚«ã‚¿ã‚«ãƒŠï¼‰ã€ã‚’é¸ã¶
            if (type === 'ingredientName' && finalName) {
                // ã‚«ãƒ³ãƒï¼ˆ,ã€ï¼Œï¼‰ã§åˆ†å‰²
                const parts = finalName.split(/[ï¼Œ,ã€]/).map(p => p.trim()).filter(p => p !== '');

                // ã¾ãšã¯å„ãƒ‘ãƒ¼ãƒˆã‹ã‚‰ã‚«ã‚¿ã‚«ãƒŠã®é€£ç¶šéƒ¨åˆ†ã‚’æ¢ã™ï¼ˆä¾‹: "ï¼¬ï¼ã‚«ãƒ«ãƒœã‚·ã‚¹ãƒ†ã‚¤ãƒ³" -> "ã‚«ãƒ«ãƒœã‚·ã‚¹ãƒ†ã‚¤ãƒ³"ï¼‰
                let candidate = '';
                for (const p of parts) {
                    const m = p.match(/([ã‚¡-ãƒ¶ãƒ¼]+)/);
                    if (m && m[1]) {
                        candidate = m[1];
                        break;
                    }
                }

                // ã‚«ã‚¿ã‚«ãƒŠãŒè¦‹ã¤ã‹ã‚‰ãªã‘ã‚Œã°ã€å…ˆé ­ã®ãƒ‘ãƒ¼ãƒˆã‹ã‚‰å…ˆé ­ã«ã‚ã‚‹ "ï¼¬" ã‚„ "L" ã¨ãƒã‚¤ãƒ•ãƒ³ã‚’å‰Šã‚‹
                if (!candidate && parts.length > 0) {
                    candidate = parts[0].replace(/^[\uFF2C\u004C][ï¼-]?/, '').trim();
                }

                // æœ€çµ‚çš„ã«å€™è£œãŒã‚ã‚Œã°ãã‚Œã‚’ä½¿ã†ï¼ˆç„¡ã‘ã‚Œã°å…ƒã® extractedName ã‚’ä½¿ã†ï¼‰
                if (candidate) {
                    finalName = candidate;
                } else if (parts.length > 0) {
                    finalName = parts[0];
>>>>>>> 15b4aceefd526650001e83b755f4ac3ffedf467d
                }
            }

            const url = `${hiyariBaseUrl}?${type}=${encodeURIComponent(finalName)}`;
            window.open(url, '_blank');
        }

<<<<<<< HEAD
        function renderTable(data) {
            const resultBody = document.getElementById('resultTableBody');
            resultBody.innerHTML = "";
=======
        // ãƒ†ãƒ¼ãƒ–ãƒ«ã®ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°é–¢æ•°ã‚’ä¿®æ­£
        function renderTable(data) {
            const resultBody = document.getElementById('resultTableBody');
            resultBody.innerHTML = "";
            const statusIndex = 11; // Låˆ—ã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
>>>>>>> 15b4aceefd526650001e83b755f4ac3ffedf467d

            if (data.length === 0) {
                const row = resultBody.insertRow();
                const cell = row.insertCell(0);
                cell.colSpan = 5;
                cell.textContent = "è©²å½“ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“";
                cell.className = "px-4 py-3 text-sm text-gray-500 text-center italic";
                return;
            }

            const displayResults = data.slice(0, 500);
<<<<<<< HEAD
            displayResults.forEach((item, index) => {
=======
            displayResults.forEach((row, index) => {
>>>>>>> 15b4aceefd526650001e83b755f4ac3ffedf467d
                const newRow = resultBody.insertRow();
                const rowBgClass = index % 2 === 1 ? 'bg-indigo-50' : 'bg-white';
                newRow.className = `${rowBgClass} transition-colors duration-150 hover:bg-indigo-200`;

<<<<<<< HEAD
                const drugNameCell = newRow.insertCell(0);
                drugNameCell.setAttribute('data-label', 'å“å');
                drugNameCell.classList.add("px-2", "py-2", "text-sm", "text-gray-900", "relative");

                let labelsHtml = '';
                const hColumnValue = (item.isGeneric || '').trim();
                const iColumnValue = (item.isBasicDrug || '').trim();
=======
                // å“å (Fåˆ—): text-sm
                const drugNameCell = newRow.insertCell(0);
                drugNameCell.setAttribute('data-label', 'å“å');
                drugNameCell.classList.add("px-2", "py-2", "text-sm", "text-gray-900");
                
                let labelsHtml = '';
                const hColumnValue = (row[7] || '').trim(); // Håˆ—: å¾Œç™ºå“ãƒ»é•·æœŸåè¼‰å“
                const iColumnValue = (row[8] || '').trim(); // Iåˆ—: åŸºç¤çš„åŒ»è–¬å“
>>>>>>> 15b4aceefd526650001e83b755f4ac3ffedf467d

                const labels = [];
                if (hColumnValue === 'å¾Œç™ºå“') {
                    labels.push(`<span class="bg-green-200 text-green-800 px-1 rounded-sm text-xs font-bold whitespace-nowrap">å¾Œ</span>`);
                }
                if (iColumnValue === 'åŸºç¤çš„åŒ»è–¬å“') {
                    labels.push(`<span class="bg-purple-200 text-purple-800 px-1 rounded-sm text-xs font-bold whitespace-nowrap">åŸº</span>`);
                }
                
                if (labels.length > 0) {
                    labelsHtml = `<div class="vertical-labels-container">${labels.join('')}</div>`;
                }

<<<<<<< HEAD
                const drugName = item.productName;
                const drugNameForHiyari = encodeURIComponent(drugName || "");

                if (!item.yjCode) {
                    drugNameCell.innerHTML = `<div class="flex items-start">${labelsHtml}<span class="font-semibold truncate-lines">${drugName || ""}</span></div>`;
                } else {
                    const pmdaLinkUrl = `https://www.pmda.go.jp/PmdaSearch/rdSearch/02/${item.yjCode}?user=1`;
                    const yjCodeLinkUrl = `./yjcode.html?yjcode=${item.yjCode}`;
                    const hiyariLinkUrl = `./hiyari_app/index.html?drugName=${drugNameForHiyari}`;
                    const dropdownContentId = `dropdown-content-${index}`;

                    const dropdownButtonHtml = `
                        <button onclick="toggleDropdown(event)" class="dropdown-button text-indigo-600 font-semibold hover:underline truncate-lines text-left w-full">
                            ${drugName || ""}
                        </button>
                    `;

                    const dropdownHtml = `
                        <div class="flex items-start">
                            ${labelsHtml}
                            <div class="dropdown w-full">
                                ${dropdownButtonHtml}
                                <div id="${dropdownContentId}" class="dropdown-content hidden absolute bg-white border border-gray-300 rounded-md shadow-lg z-10" style="min-width: 120px;">
                                    <a href="${pmdaLinkUrl}" target="_blank" class="block px-3 py-2 text-sm text-gray-800 hover:bg-indigo-100 whitespace-nowrap">åŒ»è–¬å“æƒ…å ±</a>
                                    <a href="${yjCodeLinkUrl}" target="_blank" class="block px-3 py-2 text-sm text-gray-800 hover:bg-indigo-100 whitespace-nowrap">ä»£æ›¿è–¬æ¤œç´¢</a>
                                    <a href="${hiyariLinkUrl}" target="_blank" class="block px-3 py-2 text-sm text-gray-800 hover:bg-indigo-100 whitespace-nowrap">ãƒ’ãƒ¤ãƒªãƒãƒƒãƒˆæ¤œç´¢</a>
                                </div>
                            </div>
                        </div>
                    `;
                    drugNameCell.innerHTML = dropdownHtml;
                }
                
                const ingredientNameCell = newRow.insertCell(1);
                ingredientNameCell.setAttribute('data-label', 'æˆåˆ†å');
                ingredientNameCell.classList.add("px-2", "py-2", "text-sm", "text-gray-900", "truncate-lines");
                const ingredientName = item.ingredientName || "";
                
                if (ingredientName) {
                    ingredientNameCell.innerHTML = `<a href="#" onclick="handleIngredientClick('${ingredientName.replace(/'/g, "\'")}')" class="text-indigo-600 font-semibold hover:underline">${ingredientName}</a>`;
                } else {
                    ingredientNameCell.textContent = ingredientName;
                }
                
                const statusCell = newRow.insertCell(2);
                statusCell.setAttribute('data-label', 'å‡ºè·çŠ¶æ³');
                statusCell.classList.add("tight-cell", "py-2", "text-gray-900", "text-left");

                const statusValue = (item.shipmentStatus || '').trim();
                statusCell.innerHTML = renderStatusButton(statusValue);
                
                const reasonCell = newRow.insertCell(3);
                reasonCell.textContent = item.reasonForLimitation || "";
                reasonCell.setAttribute('data-label', 'åˆ¶é™ç†ç”±');
                reasonCell.classList.add("px-2", "py-2", "text-xs", "text-gray-900", "truncate-lines");

                const volumeCell = newRow.insertCell(4);
                volumeCell.textContent = item.shipmentVolumeStatus || "";
=======
                const drugName = row[5]; // Fåˆ—
                const yjCode = row[4]; // Eåˆ—
                const pmdaLinkUrl = `https://www.pmda.go.jp/PmdaSearch/rdSearch/02/${yjCode}?user=1`;
                
                drugNameCell.innerHTML = `<div class="flex items-start">${labelsHtml}<a href="${pmdaLinkUrl}" target="_blank" class="text-indigo-600 font-semibold hover:underline truncate-lines">${drugName || ""}</a></div>`;
                
                // æˆåˆ†å (Cåˆ—): text-sm
                const ingredientNameCell = newRow.insertCell(1);
                ingredientNameCell.setAttribute('data-label', 'æˆåˆ†å');
                ingredientNameCell.classList.add("px-2", "py-2", "text-sm", "text-gray-900", "truncate-lines");
                const ingredientName = row[2] || "";
                
                if (ingredientName) {
                    ingredientNameCell.innerHTML = `<a href="#" onclick="handleIngredientClick('${ingredientName.replace(/'/g, "\\'")}')" class="text-indigo-600 font-semibold hover:underline">${ingredientName}</a>`;
                } else {
                    ingredientNameCell.textContent = ingredientName; // å…ƒã®ãƒ†ã‚­ã‚¹ãƒˆã«æˆ»ã—ã€ğŸ”µã¯åˆ¥é€”è¿½åŠ 
                }
                
                // âœ… å¤‰æ›´: å‡ºè·çŠ¶æ³ (Låˆ—): renderStatusButtonã®çµæœã‚’ãƒªãƒ³ã‚¯ã§å›²ã‚€
                const statusCell = newRow.insertCell(2);
                statusCell.setAttribute('data-label', 'å‡ºè·çŠ¶æ³');
                // tight-cellã¯paddingã®èª¿æ•´ã«ä½¿ç”¨
                statusCell.classList.add("tight-cell", "py-2", "text-gray-900", "text-left"); 
                
                const statusValue = (row[statusIndex] || '').trim();
                const statusButtonHtml = renderStatusButton(statusValue);
                
                if (yjCode) {
                    // YJã‚³ãƒ¼ãƒ‰ã¸ã®ãƒªãƒ³ã‚¯URLã‚’è¨­å®š
                    const yjCodeLinkUrl = `./yjcode.html?yjcode=${yjCode}`;
                    
                    // ãƒœã‚¿ãƒ³HTMLå…¨ä½“ã‚’ãƒã‚¤ãƒ‘ãƒ¼ãƒªãƒ³ã‚¯ã§å›²ã‚€
                    // `flex justify-center`ã‚’è¿½åŠ ã—ã¦ã€ãƒœã‚¿ãƒ³ã‚’ã‚»ãƒ«å†…ã§ä¸­å¤®æƒãˆã«ã™ã‚‹
                    statusCell.innerHTML = `<div class="flex justify-center"><a href="${yjCodeLinkUrl}" target="_blank" class="block text-indigo-600 hover:no-underline">${statusButtonHtml}</a></div>`;
                } else {
                    // YJã‚³ãƒ¼ãƒ‰ãŒãªã„å ´åˆã¯ãƒœã‚¿ãƒ³ã®ã¿è¡¨ç¤º (ä¸­å¤®æƒãˆ)
                    statusCell.innerHTML = `<div class="flex justify-center">${statusButtonHtml}</div>`;
                }
                
                // åˆ¶é™ç†ç”± (Nåˆ—): text-xs
                const reasonCell = newRow.insertCell(3);
                reasonCell.textContent = row[13] || "";
                reasonCell.setAttribute('data-label', 'åˆ¶é™ç†ç”±');
                reasonCell.classList.add("px-2", "py-2", "text-xs", "text-gray-900", "truncate-lines");

                // å‡ºè·é‡çŠ¶æ³ (Qåˆ—): text-xs
                const volumeCell = newRow.insertCell(4);
                volumeCell.textContent = row[16] || "";
>>>>>>> 15b4aceefd526650001e83b755f4ac3ffedf467d
                volumeCell.setAttribute('data-label', 'å‡ºè·é‡çŠ¶æ³');
                volumeCell.classList.add("px-2", "py-2", "text-xs", "text-gray-900");
            });
        }
<<<<<<< HEAD

        function toggleDropdown(event) {
            event.stopPropagation();
            const content = event.currentTarget.nextElementSibling;
            const isAlreadyOpen = !content.classList.contains('hidden');
            closeAllDropdowns();
            if (!isAlreadyOpen) {
                content.classList.remove('hidden');
            }
        }

        function closeAllDropdowns() {
            document.querySelectorAll('.dropdown-content').forEach(dropdown => {
                dropdown.classList.add('hidden');
            });
        }
        
=======
        
        // ã‚½ãƒ¼ãƒˆé–¢æ•°ã€ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã€window.onload ã¯å¤‰æ›´ãªã—
>>>>>>> 15b4aceefd526650001e83b755f4ac3ffedf467d
        function sortResults(key) {
            if (filteredResults.length === 0) {
                showMessage("ã‚½ãƒ¼ãƒˆã™ã‚‹ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“ã€‚", "info");
                hideMessage(2000);
                return;
            }
            const newDirection = sortStates[key] === 'asc' ? 'desc' : 'asc';
            sortStates[key] = newDirection;
            document.getElementById(`sort-${key}-icon`).textContent = newDirection === 'asc' ? 'â–²' : 'â–¼';
<<<<<<< HEAD
            
            filteredResults.sort((a, b) => {
                const aValue = (a.shipmentStatus || '').trim();
                const bValue = (b.shipmentStatus || '').trim();
                const compare = aValue.localeCompare(bValue, 'ja', { sensitivity: 'base' });
                return newDirection === 'asc' ? compare : -compare;
            });

=======
            filteredResults.sort((a, b) => {
                const aValue = (a[11] || '').trim();
                const bValue = (b[11] || '').trim();
                const compare = aValue.localeCompare(bValue, 'ja', { sensitivity: 'base' });
                return newDirection === 'asc' ? compare : -compare;
            });
>>>>>>> 15b4aceefd526650001e83b755f4ac3ffedf467d
            renderTable(filteredResults);
            showMessage(`ã€Œå‡ºè·çŠ¶æ³ã€ã‚’${newDirection === 'asc' ? 'æ˜‡é †' : 'é™é †'}ã§ã‚½ãƒ¼ãƒˆã—ã¾ã—ãŸã€‚`, "success");
            hideMessage(2000);
        }
        
        function formatDate(date) {
            const year = date.getFullYear().toString().slice(-2);
            const month = (date.getMonth() + 1).toString().padStart(2, '0');
            const day = date.getDate().toString().padStart(2, '0');
            return `${year}${month}${day}`;
        }

        function attachSearchListeners() {
            const inputIds = ['drugName', 'ingredientName', 'makerName'];

            inputIds.forEach(id => {
                const element = document.getElementById(id);
                
                element.addEventListener('compositionstart', () => {
                    isComposing = true;
                });

                element.addEventListener('compositionend', () => {
                    isComposing = false;
                    searchData(); 
                });

                element.addEventListener('input', () => {
                    if (!isComposing) {
                        searchData();
                    }
                });
            });

            document.getElementById('statusNormal').addEventListener('change', searchData);
            document.getElementById('statusLimited').addEventListener('change', searchData);
            document.getElementById('statusStopped').addEventListener('change', searchData);
        }

        window.onload = function() {
<<<<<<< HEAD
            attachSearchListeners();
            window.addEventListener('click', closeAllDropdowns);

            const fileId = '1yhDbdCbnmDoXKRSj_CuLgKkIH2ohK1LD';
            const googleDriveUrl = `https://docs.google.com/spreadsheets/d/${fileId}/export?format=xlsx`;

            async function fetchSpreadsheetData() {
                showMessage('å…±æœ‰ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ä¸­ã§ã™...', 'info');
                try {
                    const response = await fetch(googleDriveUrl, { cache: "no-cache" });
                    if (response.ok) {
                        const data = await response.arrayBuffer();
                        processExcelData(new Uint8Array(data));

                        if (excelData.length > 0) {
                            const cachePayload = {
                                timestamp: new Date().getTime(),
                                data: excelData
                            };
                            localforage.setItem('excelCache', cachePayload).catch(err => {
                                console.error("Failed to save data to localForage", err);
                            });
                            showMessage(`${excelData.length} ä»¶ã®ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸã€‚æ¤œç´¢ã‚’é–‹å§‹ã§ãã¾ã™ã€‚`, "success");
                        } else {
                            showMessage("ãƒ‡ãƒ¼ã‚¿ãŒ0ä»¶ã§ã—ãŸã€‚ãƒ•ã‚¡ã‚¤ãƒ«ã¾ãŸã¯å‡¦ç†ãƒ­ã‚¸ãƒƒã‚¯ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚", "error");
                        }
                        renderTable([]);
                        tableContainer.classList.add('hidden');
                        hideMessage(3000);
                    } else {
                        showMessage(`ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰: ${response.status}`, 'error');
=======
            const spreadsheetId = '1yhDbdCbnmDoXKRSj_CuLgKkIH2ohK1LD';
            const exportUrl = `https://docs.google.com/spreadsheets/d/${spreadsheetId}/export?format=xlsx`;

            async function fetchSpreadsheetData() {
                showMessage('å…±æœ‰ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ä¸­ã§ã™...', 'info');
                
                try {
                    const response = await fetch(exportUrl);
                    if (response.ok) {
                        const data = await response.arrayBuffer();
                        processExcelData(new Uint8Array(data));
                        renderTable([]);
                        tableContainer.classList.add('hidden'); 
                        showMessage("ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ãŒå®Œäº†ã—ã¾ã—ãŸã€‚æ¤œç´¢æ¬„ã«å…¥åŠ›ã™ã‚‹ã¨è‡ªå‹•ã§çµã‚Šè¾¼ã¿ãŒé–‹å§‹ã•ã‚Œã¾ã™ã€‚", "success");
                        hideMessage(2000);
                    } else {
                        showMessage(`ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰: ${response.status}`, 'error');
                        hideMessage(2000);
>>>>>>> 15b4aceefd526650001e83b755f4ac3ffedf467d
                    }
                } catch (error) {
                    console.error('ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ:', error);
                    showMessage('å…±æœ‰ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã‹ã‚‰ã®ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚', 'error');
<<<<<<< HEAD
                }
            }

            localforage.getItem('excelCache').then(cachedData => {
                const fourHours = 4 * 60 * 60 * 1000;
                if (cachedData && (new Date().getTime() - cachedData.timestamp < fourHours)) {
                    console.log("Found recent cached data in localForage.");
                    excelData = cachedData.data;
                    renderTable([]);
                    tableContainer.classList.add('hidden');
                    showMessage(`ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‹ã‚‰ ${excelData.length} ä»¶ã®ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸã€‚æ¤œç´¢ã‚’é–‹å§‹ã§ãã¾ã™ã€‚`, "success");
                    hideMessage(3000);
                } else {
                    if(cachedData) {
                        console.log("Cached data is old. Fetching from network.");
                    } else {
                        console.log("No cached data found. Fetching from network.");
                    }
                    fetchSpreadsheetData();
                }
            }).catch(err => {
                console.error("Error reading from localForage, fetching from network.", err);
                fetchSpreadsheetData();
            });
        };
    </script>
</body>
</html>
=======
                    hideMessage(2000);
                }
            }
            
            attachSearchListeners();
            fetchSpreadsheetData();
        };
    </script>
</body>
</html>
>>>>>>> 15b4aceefd526650001e83b755f4ac3ffedf467d
